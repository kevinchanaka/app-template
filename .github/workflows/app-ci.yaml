name: App CI

# 1. determine changed files
# 2. trigger CI for appropriate app (client or server)

on:
  pull_request:
    branches: [ "main" ]

jobs:
  determine-changed-directories:
    runs-on: ubuntu-latest
    outputs:
      changed-dirs: ${{ steps.get-changed-directories.outputs.changed-dirs }}
    steps:
      - name: Checkout PR branch
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get list of changed root directories
        id: get-changed-directories
        run: |
          CHANGED_FILES=$(git diff --name-only origin/main...HEAD)

          echo "Changed files:"
          echo "$CHANGED_FILES"

          CHANGED_DIRS=$(echo "$CHANGED_FILES" | cut -d/ -f1 | sort -u)
          CHANGED_DIRS_CSV=$(echo "$CHANGED_DIRS" | tr '\n' ',' | sed 's/,$//')

          echo "Detected changed directories: $CHANGED_DIRS_CSV"
          echo "changed_dirs=$CHANGED_DIRS_CSV" >> $GITHUB_OUTPUT


          

      # - uses: actions/setup-node@v4
      #   with:
      #     node-version: 22